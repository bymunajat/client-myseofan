RewriteEngine On
RewriteBase /

# ----------------------------------------------------------------------
# SECURITY HEADERS & RULES
# ----------------------------------------------------------------------

# 1. Block access to sensitive files
<FilesMatch "\.(db|sqlite|log|ini|sh|git|env|lock)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# 2. Block access to specific system names
<FilesMatch "^(composer\.json|package\.json|readme\.md|license|changelog\.md)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# 2b. Block access to sensitive directories
RedirectMatch 403 ^/(scripts|includes|migrations|database)/.*$

# 3. Disable Directory Browsing
Options -Indexes

# Redirect root to default language if no lang param
# This is handled in index.php logic, but we can help it here
# RewriteRule ^$ /en [L,R=301]

# Language Slugs: /en, /id, /es, etc.
RewriteRule ^([a-z]{2})$ index.php?lang=$1 [QSA,L]
RewriteRule ^([a-z]{2})/$ index.php?lang=$1 [QSA,L]

# SEO Friendly URLs for Blog
RewriteRule ^blog/([a-z]{2})$ blog.php?lang=$1 [QSA,L]
RewriteRule ^post/([^/]+)/([a-z]{2})$ post.php?slug=$1&lang=$2 [QSA,L]
RewriteRule ^post/([^/]+)$ post.php?slug=$1 [QSA,L]

# SEO Friendly URLs for Static Pages
RewriteRule ^page/([^/]+)/([a-z]{2})$ page.php?slug=$1&lang=$2 [QSA,L]
RewriteRule ^page/([^/]+)$ page.php?slug=$1 [QSA,L]

# Remove .php from URL (as fallback)
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^([^\.]+)$ $1.php [NC,L]
